#!/system/bin/sh
# Volume Steps+ for Magisk 17+
# Original source by: veez21 @xda-developers 
# Remake and Upgrade by: WilomanCZ


# Default Variables
div="=================================";
MODDIR="/sbin/.magisk/img/VolumeStepsPlus";
prop=$MODDIR/system.prop;

#Functions
get_file_prop() {
_prop=$2
_prop=$(grep "$1=" $_prop)
val=${_prop#*=}
echo $val
unset _prop
}

set_file_prop() {
_prop=$3
sed -i "s/${1}=.*/${1}=${2}/g" $_prop
unset _prop
}


# Extra Variables
VER=$(get_file_prop version $MODDIR/module.prop);
REL=$(get_file_prop versionCode $MODDIR/module.prop);
AUT=$(get_file_prop author $MODDIR/module.prop);
NAM=$(get_file_prop name $MODDIR/module.prop);
SCRN="Safe Media Bypass";

# Main
clear;

current=$(getprop audio.safemedia.bypass);
applied=$(get_file_prop audio.safemedia.bypass $prop);

echo $div;
echo "$SCRN -  ${NAM}";
echo $div;
echo "";
echo "Version ${VER}.${REL}";
echo "Author: ${AUT}";
echo "";
echo "Change Value of $SCRN";
echo "- Write number     1    For: On (True)";
echo "- Write number     0   For: Off (False)";
echo $div;
echo "";
echo $div;
echo "Current: $current";

if [ "$current" != "$applied" ]; then
	echo "To be applied: $applied" ;
	echo "NOTE: REBOOT TO APPLY CHANGES";
fi 

echo $div;
echo "";
echo -n "Change to: ";
read text

data="null" ;
datasend="audio.safemedia.bypass";

 if [ "$text" == "1" ] ; then
        data="true";
        set_file_prop ${datasend} ${data} $prop;
        echo "Changed to $data";
        sleep 2;
        echo "Reboot device for apply changes.";
        sleep 1;
	exit;  
elif [ "$text" == "0" ] ; then
	    data="false";
        set_file_prop ${datasend} ${data} $prop;
        echo "Changed to $data";
        sleep 2;
        echo "Reboot device for apply changes.";
        sleep 1;
	exit;  
 else
        echo "Only numbers 1 or 0 nothing else!!!";
        sleep 1;
        exit;
fi
